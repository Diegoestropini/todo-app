<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Lista de Tareas</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-Mj145p2O6rIb+eUCU38fzEFXtsgejLx5wwc3Dupb8PC66XEzfWZt9/Atp3ctdPP6LANt8qfSluZ0G8Aqoy7+kQ==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <style>
    :root {
      color-scheme: light dark;
    }

    body {
      font-family: 'Segoe UI', Arial, Helvetica, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #d7e1ec 100%);
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 40px 16px;
    }

    .app {
      width: min(90vw, 480px);
      background: rgba(255, 255, 255, 0.92);
      border-radius: 24px;
      box-shadow: 0 25px 50px -12px rgba(15, 23, 42, 0.25);
      padding: 32px;
      backdrop-filter: blur(18px);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    h1 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 28px;
      font-size: 2rem;
      font-weight: 700;
      color: #1f2937;
      letter-spacing: -0.02em;
    }

    form {
      display: flex;
      gap: 12px;
      margin-bottom: 18px;
    }

    form input[type="text"] {
      flex: 1;
      padding: 12px 14px;
      border: 1px solid #cbd5f5;
      border-radius: 14px;
      font-size: 1rem;
      background: #f8fbff;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    form input[type="text"]:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }

    form button {
      padding: 12px 18px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: #ffffff;
      border: none;
      border-radius: 14px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    form button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
    }

    .filters {
      display: flex;
      gap: 10px;
    }

    .filter-btn {
      border: none;
      background: rgba(99, 102, 241, 0.12);
      color: #3730a3;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .filter-btn:hover {
      transform: translateY(-1px);
      background: rgba(99, 102, 241, 0.2);
    }

    .filter-btn.active {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      color: #ffffff;
      box-shadow: 0 10px 20px rgba(124, 58, 237, 0.25);
    }

    #pending-count {
      font-size: 0.95rem;
      color: #475569;
      font-weight: 600;
    }

    #task-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    #task-list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: linear-gradient(135deg, rgba(248, 250, 255, 0.95), rgba(237, 242, 255, 0.9));
      box-shadow: 0 10px 25px -12px rgba(30, 41, 59, 0.3);
    }

    .task-text {
      flex: 1;
      margin-right: 12px;
      word-break: break-word;
      color: #1e293b;
      font-weight: 500;
      transition: color 0.2s ease-in-out, opacity 0.2s ease-in-out;
    }

    .task-text.completed {
      text-decoration: line-through;
      color: #94a3b8;
      opacity: 0.7;
    }

    .task-actions {
      display: flex;
      gap: 10px;
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 50%;
      display: grid;
      place-items: center;
      cursor: pointer;
      font-size: 1.05rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .icon-btn.complete {
      background: rgba(16, 185, 129, 0.15);
      color: #047857;
    }

    .icon-btn.complete:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(16, 185, 129, 0.2);
    }

    .icon-btn.delete {
      background: rgba(239, 68, 68, 0.15);
      color: #b91c1c;
    }

    .icon-btn.delete:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(239, 68, 68, 0.2);
    }

    #empty-state {
      text-align: center;
      color: #64748b;
      margin-top: 20px;
      display: none;
    }

    @media (max-width: 480px) {
      .app {
        padding: 24px;
      }

      form {
        flex-direction: column;
      }

      form button {
        width: 100%;
      }

      .filters {
        width: 100%;
        justify-content: space-between;
      }

      .filter-btn {
        flex: 1;
        text-align: center;
      }

      .icon-btn {
        width: 36px;
        height: 36px;
      }
    }

    @media (prefers-color-scheme: dark) {
      body {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      }

      .app {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.2);
        color: #e2e8f0;
      }

      h1 {
        color: #e0e7ff;
      }

      form input[type="text"] {
        background: rgba(15, 23, 42, 0.6);
        border-color: rgba(99, 102, 241, 0.4);
        color: #e2e8f0;
      }

      form button {
        box-shadow: none;
      }

      .filter-btn {
        background: rgba(99, 102, 241, 0.18);
        color: #c7d2fe;
      }

      .filter-btn.active {
        box-shadow: none;
      }

      #pending-count {
        color: #cbd5f5;
      }

      #task-list li {
        background: rgba(30, 41, 59, 0.85);
        border-color: rgba(99, 102, 241, 0.25);
        box-shadow: none;
      }

      .task-text {
        color: #e2e8f0;
      }

      .task-text.completed {
        color: #94a3b8;
      }

      .icon-btn.complete {
        background: rgba(16, 185, 129, 0.18);
        color: #34d399;
      }

      .icon-btn.delete {
        background: rgba(239, 68, 68, 0.18);
        color: #f87171;
      }

      #empty-state {
        color: #94a3b8;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Lista de Tareas</h1>
    <form id="task-form" autocomplete="off">
      <input type="text" id="task-input" placeholder="Escribe una tarea..." required>
      <button type="submit">Agregar</button>
    </form>

    <div class="toolbar" role="toolbar" aria-label="Filtros de tareas">
      <div class="filters">
        <button type="button" class="filter-btn active" data-filter="all">Todas</button>
        <button type="button" class="filter-btn" data-filter="pending">Pendientes</button>
        <button type="button" class="filter-btn" data-filter="completed">Completadas</button>
      </div>
      <span id="pending-count" aria-live="polite"></span>
    </div>

    <ul id="task-list"></ul>
    <p id="empty-state">No hay tareas todavia.</p>
  </div>

  <script>
    (() => {
      const form = document.getElementById('task-form');
      const input = document.getElementById('task-input');
      const list = document.getElementById('task-list');
      const emptyState = document.getElementById('empty-state');
      const pendingCount = document.getElementById('pending-count');
      const filterButtons = document.querySelectorAll('.filter-btn');
      const storageKey = 'todoTasks';

      let tasks = [];
      let currentFilter = 'all';

      let fallbackCounter = 0;

      const generateId = () => {
        if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') {
          return crypto.randomUUID();
        }
        fallbackCounter += 1;
        return `${Date.now()}-${fallbackCounter}`;
      };

      const emptyMessages = {
        all: 'No hay tareas todavia.',
        pending: 'No hay tareas pendientes.',
        completed: 'No hay tareas completadas.'
      };

      const saveTasks = () => {
        localStorage.setItem(storageKey, JSON.stringify(tasks));
      };

      const updatePendingCount = () => {
        const count = tasks.filter(task => !task.completed).length;
        const label = count === 1 ? '1 tarea pendiente' : `${count} tareas pendientes`;
        pendingCount.textContent = label;
      };

      const getFilteredTasks = () => {
        if (currentFilter === 'pending') {
          return tasks.filter(task => !task.completed);
        }
        if (currentFilter === 'completed') {
          return tasks.filter(task => task.completed);
        }
        return tasks;
      };

      const updateEmptyState = (filteredTasks) => {
        emptyState.textContent = emptyMessages[currentFilter];
        emptyState.style.display = filteredTasks.length === 0 ? 'block' : 'none';
      };

      const createIcon = (classes) => {
        const icon = document.createElement('i');
        icon.className = classes;
        icon.setAttribute('aria-hidden', 'true');
        return icon;
      };

      const renderTasks = () => {
        list.innerHTML = '';
        const filteredTasks = getFilteredTasks();

        filteredTasks.forEach(task => {
          const item = document.createElement('li');
          item.dataset.id = task.id;

          const text = document.createElement('span');
          text.className = 'task-text' + (task.completed ? ' completed' : '');
          text.textContent = task.text;

          const actions = document.createElement('div');
          actions.className = 'task-actions';

          const completeButton = document.createElement('button');
          completeButton.type = 'button';
          completeButton.className = 'icon-btn complete';
          completeButton.title = task.completed ? 'Desmarcar tarea' : 'Completar tarea';
          completeButton.setAttribute('aria-label', completeButton.title);
          completeButton.appendChild(createIcon(task.completed ? 'fa-solid fa-rotate-left' : 'fa-solid fa-check'));
          completeButton.addEventListener('click', () => toggleTask(task.id));

          const deleteButton = document.createElement('button');
          deleteButton.type = 'button';
          deleteButton.className = 'icon-btn delete';
          deleteButton.title = 'Eliminar tarea';
          deleteButton.setAttribute('aria-label', deleteButton.title);
          deleteButton.appendChild(createIcon('fa-solid fa-trash'));
          deleteButton.addEventListener('click', () => deleteTask(task.id));

          actions.append(completeButton, deleteButton);
          item.append(text, actions);
          list.appendChild(item);
        });

        updateEmptyState(filteredTasks);
        updatePendingCount();
      };

      const addTask = (text) => {
        const trimmed = text.trim();
        if (!trimmed) {
          input.focus();
          return;
        }

        const newTask = {
          id: generateId(),
          text: trimmed,
          completed: false
        };

        tasks.push(newTask);
        saveTasks();
        renderTasks();
      };

      const toggleTask = (id) => {
        tasks = tasks.map(task => {
          if (task.id !== id) {
            return task;
          }
          return { ...task, completed: !task.completed };
        });
        saveTasks();
        renderTasks();
      };

      const deleteTask = (id) => {
        tasks = tasks.filter(task => task.id !== id);
        saveTasks();
        renderTasks();
      };

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        addTask(input.value);
        form.reset();
        input.focus();
      });

      filterButtons.forEach(button => {
        button.addEventListener('click', () => {
          currentFilter = button.dataset.filter;
          filterButtons.forEach(btn => btn.classList.toggle('active', btn === button));
          renderTasks();
        });
      });

      const storedTasks = localStorage.getItem(storageKey);
      if (storedTasks) {
        try {
          const parsed = JSON.parse(storedTasks);
          if (Array.isArray(parsed)) {
            tasks = parsed
              .filter(task => task && typeof task.text === 'string')
              .map(task => ({
                id: task.id || generateId(),
                text: task.text,
                completed: Boolean(task.completed)
              }));
            saveTasks();
          }
        } catch (error) {
          console.error('No se pudieron cargar las tareas guardadas:', error);
        }
      }

      renderTasks();
    })();
  </script>
</body>
</html>
